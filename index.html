<!-- ================================================================ -->
<!-- index.html -->
<!-- ================================================================ -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle Financeiro</title>

    <!-- VERIFICAÇÃO DE AUTENTICAÇÃO (ANTES DE TUDO) -->
    <script>
        (function() {
            // Verificar se há dados salvos com "lembrar de mim"
            var lembrarToken = localStorage.getItem('lembrarToken');
            var lembrarUsuario = localStorage.getItem('lembrarUsuario');
            var lembrarDados = localStorage.getItem('lembrarDadosUsuario');

            // Se tem dados salvos no localStorage, restaurar para sessionStorage
            if (lembrarToken && lembrarUsuario) {
                if (!sessionStorage.getItem('token')) {
                    sessionStorage.setItem('token', lembrarToken);
                }
                if (!sessionStorage.getItem('usuarioAtual')) {
                    sessionStorage.setItem('usuarioAtual', lembrarUsuario);
                }
                if (lembrarDados && !sessionStorage.getItem('dadosUsuarioLogado')) {
                    sessionStorage.setItem('dadosUsuarioLogado', lembrarDados);
                }
            }

            // Verificar autenticação
            var usuarioAtual = sessionStorage.getItem('usuarioAtual');
            if (!usuarioAtual) {
                window.location.replace('login.html');
            }
        })();
    </script>

    <!-- CSS EXTERNOS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CSS DO SISTEMA -->
    <link rel="stylesheet" href="css/layoutGeral.css">
    <link rel="stylesheet" href="css/botoes.css">
    <link rel="stylesheet" href="css/modais.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/receita.css">
    <link rel="stylesheet" href="css/despesa.css">
    <link rel="stylesheet" href="css/notificacao.css">
    <link rel="stylesheet" href="css/rel.css">
    <link rel="stylesheet" href="css/config.css">
</head>
<body>

    
<!-- ================================================================ -->
<!-- ESTRUTURA PRINCIPAL DA APLICAÇÃO -->
<!-- ================================================================ -->
<div class="app-container">
    
    <!-- ============================================================ -->
    <!-- SIDEBAR DE NAVEGAÇÃO PRINCIPAL -->
    <!-- ============================================================ -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Sistema Financeiro</h3>
            <div class="user-profile-sidebar">
                <div class="avatar-container" id="avatar-container" title="Clique para alterar a foto">
                    <div class="avatar-img" id="avatar-img">
                        <i class="fas fa-user avatar-placeholder"></i>
                    </div>
                    <div class="avatar-edit-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <input type="file" id="input-foto-perfil" accept="image/*" style="display:none">
                <div class="user-info-sidebar">
                    <span id="nome-usuario-sidebar"></span>
                </div>
            </div>
        </div>
        <ul class="sidebar-nav">
            <li class="nav-item">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                    <span class="nav-text">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="meses">
                    <span class="nav-icon"><i class="fas fa-calendar-alt"></i></span>
                    <span class="nav-text">Meses</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="relatorios" id="nav-relatorios">
                    <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                    <span class="nav-text">Relatórios</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link" data-section="config">
                    <span class="nav-icon"><i class="fas fa-user-cog"></i></span>
                    <span class="nav-text">Configurações</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="system-info">
                <div class="info-row">
                    <i class="fas fa-code-branch"></i>
                    <span>v<span id="system-version">1.0.0</span></span>
                </div>
                <div class="info-row info-secondary">
                    <i class="fas fa-calendar"></i>
                    <span id="system-update-date">03/01/2026</span>
                </div>
            </div>
        </div>
    </nav>

   <main class="main-content">
        <header class="main-header">
            <!-- Esquerda: Ações principais -->
            <div class="header-left">
                <button id="btn-adicionar-receita-rapida" class="header-action-btn header-action-receita">
                    <i class="fas fa-plus"></i> RECEITA
                </button>
                <button id="btn-adicionar-despesa-rapida" class="header-action-btn header-action-despesa">
                    <i class="fas fa-plus"></i> DESPESA
                </button>
            </div>

            <!-- Centro: Cotações + Ano -->
            <div class="header-center">
                <div class="cambio-container-compact" title="Cotações em tempo real">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="cotacoes-compact">Carregando...</span>
                </div>
                <div class="header-separator"></div>
                <div class="periodo-selector">
                    <button class="header-btn" id="btn-ano-anterior" title="Ano Anterior">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="ano-dropdown">
                        <button class="header-btn header-btn-year" id="ano-atual-btn">2026</button>
                        <div id="dropdown-anos" class="dropdown-anos-lista">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                    <button class="header-btn" id="btn-proximo-ano" title="Próximo Ano">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Direita: Ícones utilitários -->
            <div class="header-right">
                <div class="ano-menu-container">
                    <button class="header-btn" id="btn-ano-menu" title="Gerenciar Ano">
                        <i class="fas fa-cog"></i>
                    </button>
                    <div id="dropdown-ano-menu" class="dropdown-ano-menu">
                        <button id="btn-novo-ano-menu" class="dropdown-item">
                            <i class="fas fa-calendar-plus"></i> Criar Novo Ano
                        </button>
                        <button id="btn-excluir-ano-menu" class="dropdown-item dropdown-item-danger">
                            <i class="fas fa-calendar-times"></i> Excluir Ano Atual
                        </button>
                        <div class="dropdown-divider"></div>
                        <button id="btn-alterar-senha-menu" class="dropdown-item">
                            <i class="fas fa-key"></i> Alterar Senha
                        </button>
                    </div>
                </div>
                <button class="header-btn" id="btn-toggle-noticias" type="button" title="Ver Notícias">
                    <i class="fas fa-newspaper"></i>
                </button>
                <button class="header-btn" id="btn-refresh" title="Atualizar Dados">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="header-btn" id="btn-lock-system" title="Bloquear Sistema">
                    <i class="fas fa-lock"></i>
                </button>
                <div class="notification-wrapper">
                    <button class="header-btn" id="notification-bell" type="button" aria-label="Notificações">
                        <i class="fas fa-bell"></i>
                    </button>
                    <span class="notification-badge" id="notification-count">0</span>
                </div>
                <button class="header-btn" id="logout-btn" title="Sair">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Marquee colapsável -->
        <div id="marquee-noticias" class="marquee-container" style="display: none;">
            <div class="marquee-content" id="conteudo-noticias"></div>
        </div>

        <!-- ======================================================== -->
        <!-- CONTAINER DE TODAS AS SEÇÕES -->
        <!-- SEÇÃO 1: DASHBOARD/ANÁLISE FINANCEIRA -->
        <!-- ======================================================== -->
       <div class="content-area">
    <section class="dashboard-section active" id="dashboard-section">
        <div class="resumo-cards">
            <div class="card card-receitas">
                <div class="card-header">
                    <i class="fas fa-arrow-up"></i>
                    <span>RECEITAS TOTAIS</span>
                </div>
                <div class="card-value" id="dashboard-total-receitas">R$ 0,00</div>
                <div class="card-footer">Todas as receitas do ano</div>
            </div>
            <div class="card card-despesas">
                <div class="card-header">
                    <i class="fas fa-arrow-down"></i>
                    <span>DESPESAS TOTAIS</span>
                </div>
                <div class="card-value" id="dashboard-total-despesas">R$ 0,00</div>
                <div class="card-footer">Todas as despesas do ano</div>
            </div>
            <div class="card card-saldo">
                <div class="card-header">
                    <i class="fas fa-wallet"></i>
                    <span>SALDO ANUAL</span>
                </div>
                <div class="card-value" id="dashboard-saldo-anual">R$ 0,00</div>
                <div class="card-footer">Balanço receitas - despesas</div>
            </div>
            <div class="card card-juros">
                <div class="card-header">
                    <i class="fas fa-percentage"></i>
                    <span>JUROS PAGOS</span>
                </div>
                <div class="card-value" id="dashboard-total-juros">R$ 0,00</div>
                <div class="card-footer">Total de juros pagos no ano</div>
            </div>
            <div class="card card-economias">
                <div class="card-header">
                    <i class="fas fa-piggy-bank"></i>
                    <span>ECONOMIAS</span>
                </div>
                <div class="card-value" id="dashboard-total-economias">R$ 0,00</div>
                <div class="card-footer">Valor economizado no ano</div>
            </div>
        </div>

       

        <div class="dashboard-grid">

            <div class="dashboard-card">
                <h3>
                    <span>TENDÊNCIA ANUAL</span>
                    <div class="filtros-header">
                        <select class="form-control" id="tendencia-tipo-filter" onchange="filtrarTendencia()">
                            <option value="ambos">Receitas e Despesas</option>
                            <option value="receitas">Apenas Receitas</option>
                            <option value="despesas">Apenas Despesas</option>
                        </select>
                        <select class="form-control" id="tendencia-categoria-filter" onchange="filtrarTendencia()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="tendencia-pagamento-filter" onchange="filtrarTendencia()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="tendenciaChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="tendencia-chart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>
                    <span>ENTRADAS E SAÍDAS</span>
                    <div class="filtros-header">
                        <select class="form-control" id="receitas-despesas-tipo-filter" onchange="filtrarReceitasDespesas()">
                            <option value="ambos">Receitas e Despesas</option>
                            <option value="receitas">Apenas Receitas</option>
                            <option value="despesas">Apenas Despesas</option>
                        </select>
                        <select class="form-control" id="receitas-despesas-categoria-filter" onchange="filtrarReceitasDespesas()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="receitas-despesas-pagamento-filter" onchange="filtrarReceitasDespesas()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="receitasDespesasChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="receitas-despesas-chart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>
                    <span>CATEGORIAS ANUAIS</span>
                    <div class="filtros-header">
                        <select class="form-control" id="categorias-anual-categoria-filter" onchange="filtrarCategoriasAnual()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="categorias-anual-pagamento-filter" onchange="filtrarCategoriasAnual()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="categoriasBarrasChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="categorias-barras-chart"></canvas>
                </div>
            </div>

             <div class="dashboard-card">
                <h3>
                    <span>MÉDIA POR CATEGORIA (ANUAL)</span>
                    <div class="filtros-header">
                        <select class="form-control" id="media-cat-pagamento-filter" onchange="renderizarGraficoMediaCategorias()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="mediaCategoriasChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="media-categorias-chart"></canvas>
                </div>
            </div>

            
            <div class="dashboard-card">
                <h3>
                    <span>CATEGORIAS MENSAIS</span>
                    <div class="filtros-header">
                        <select class="form-control" id="categorias-mensal-categoria-filter" onchange="filtrarCategoriasMensal()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="categorias-mensal-pagamento-filter" onchange="filtrarCategoriasMensal()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="categoriasEmpilhadasChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="categorias-mensais-chart"></canvas>
                </div>
            </div>

     <div class="dashboard-card">
                <h3>
                    <span>FORMAS DE PAGAMENTO</span>
                    <div class="filtros-header">
                        <select class="form-control" id="forma-pagamento-categoria-filter" onchange="filtrarFormaPagamento()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="forma-pagamento-pagamento-filter" onchange="filtrarFormaPagamento()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="formaPagamentoChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="forma-pagamento-chart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>
                    <span>USO DE CARTOES</span>
                    <div class="filtros-header">
                        <select class="form-control" id="cartoes-categoria-filter" onchange="aplicarFiltroDistribuicaoCartoes()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="chartDistribuicaoCartoes">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="cartoes-usados-chart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>
                    <span>JUROS MENSAIS</span>
                    <div class="filtros-header">
                        <select class="form-control" id="juros-categoria-filter" onchange="filtrarJuros()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="juros-pagamento-filter" onchange="filtrarJuros()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <select class="form-control" id="juros-status-filter" onchange="filtrarJuros()">
                            <option value="todos">Todos</option>
                            <option value="pagos">Apenas Pagos</option>
                            <option value="pendentes">Apenas Pendentes</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="jurosChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="juros-chart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>
                    <span>PARCELAMENTOS MENSAIS</span>
                    <div class="filtros-header">
                        <select class="form-control" id="parcelamentos-categoria-filter" onchange="filtrarParcelamentos()">
                            <option value="">Todas as categorias</option>
                        </select>
                        <select class="form-control" id="parcelamentos-pagamento-filter" onchange="filtrarParcelamentos()">
                            <option value="todas">Todas as formas</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <select class="form-control" id="parcelamentos-status-filter" onchange="filtrarParcelamentos()">
                            <option value="todos">Todos</option>
                            <option value="pagos">Apenas Pagos</option>
                            <option value="pendentes">Apenas Pendentes</option>
                        </select>
                        <button class="btn btn-icon btn-outline" data-chart="parcelamentosChart">[ ]</button>
                    </div>
                </h3>
                <div class="chart-container">
                    <canvas id="parcelamentos-chart"></canvas>
                </div>
            </div>

         <div class="dashboard-card dashboard-card-full">
            <h3 class="header-com-zoom">
                <span>BALANÇO</span>
                <div class="filtros-header">
                    <select class="form-control" id="balanco-periodo-filter" onchange="filtrarBalancoPeriodo()">
                        <option value="ano">Ano</option>
                        <option value="mes">Mês</option>
                        <option value="semana">Semana</option>
                        <option value="dia">Dia</option>
                    </select>
                    <select class="form-control" id="balanco-ano-filter" onchange="filtrarBalancoPeriodo()" style="display: none;">
                        <!-- Preenchido dinamicamente -->
                    </select>
                    <select class="form-control" id="balanco-mes-filter" onchange="filtrarBalancoPeriodo()" style="display: none;">
                        <option value="0">Janeiro</option>
                        <option value="1">Fevereiro</option>
                        <option value="2">Março</option>
                        <option value="3">Abril</option>
                        <option value="4">Maio</option>
                        <option value="5">Junho</option>
                        <option value="6">Julho</option>
                        <option value="7">Agosto</option>
                        <option value="8">Setembro</option>
                        <option value="9">Outubro</option>
                        <option value="10">Novembro</option>
                        <option value="11">Dezembro</option>
                    </select>
                </div>
                <button class="btn btn-icon btn-outline" data-chart="balancoChart">[ ]</button>
            </h3>
            <div class="chart-container">
                <canvas id="balanco-chart"></canvas>
            </div>
        </div>

        </div>
    </section>

<div id="modal-zoom-grafico" class="modal-zoom-container">
    <div class="modal-zoom-content">
        <button type="button" id="fechar-modal-zoom" class="close" title="Fechar">&times;</button>
        <canvas id="canvas-zoom-render"></canvas>
    </div>
</div>


    <!-- ================================================== -->
    <!-- SEÇÃO 2: VISUALIZAÇÃO MENSAL -->
    <!-- ================================================== -->
    <section class="meses-section" id="meses-section">
        <div class="meses-container">
        </div>
    </section>

<!-- ================================================================
   SEÇÃO DE RELATÓRIOS
   ================================================================ -->
<section class="relatorios-section" id="relatorios-section">
    <div class="relatorios-filtros-container">
        <div class="filtros-card">
            
            <div class="filtros-linha filtros-linha-super-compacta">
                <div class="filtro-grupo filtro-periodo">
                    <label for="filtro-periodo">Período:</label>
                    <select id="filtro-periodo" class="form-control">
                        <option value="mes-atual">Mês Atual</option>
                        <option value="mes-anterior">Mês Anterior</option>
                        <option value="ultimos-3-meses">Últimos 3 Meses</option>
                        <option value="ultimos-6-meses">Últimos 6 Meses</option>
                        <option value="ano-atual">Ano Atual</option>
                        <option value="ano-anterior">Ano Anterior</option>
                        <option value="personalizado">Período Personalizado</option>
                    </select>
                </div>
                
                <div class="filtro-grupo filtro-tipo">
                    <label for="filtro-tipo-relatorio">Tipo:</label>
                    <select id="filtro-tipo-relatorio" class="form-control">
                        <option value="completo">Completo</option>
                        <option value="apenas-receitas">Receitas</option>
                        <option value="apenas-despesas">Despesas</option>
                        <option value="por-categoria">Por Categoria</option>
                        <option value="por-forma-pagamento">Por Pagamento</option>
                        <option value="parcelamentos">Parcelamentos</option>
                        <option value="gastos-reais">Gastos Reais</option>
                    </select>
                </div>
                
                <div class="filtro-grupo filtro-criterio">
                    <label for="filtro-criterio-data">Data:</label>
                    <select id="filtro-criterio-data" class="form-control">
                        <option value="vencimento">Vencimento</option>
                        <option value="compra">Compra</option>
                        <option value="pagamento">Pagamento</option>
                        <option value="mista">Mista</option>
                    </select>
                </div>

                <div class="filtro-grupo filtro-categoria">
                    <label for="filtro-categoria-relatorio">Categoria:</label>
                    <select id="filtro-categoria-relatorio" class="form-control">
                        <option value="todas">Todas</option>
                    </select>
                </div>

                <div class="filtro-grupo filtro-status">
                    <label for="filtro-status-relatorio">Status:</label>
                    <select id="filtro-status-relatorio" class="form-control">
                        <option value="todos">Todos</option>
                        <option value="quitadas">Pagas</option>
                        <option value="pendentes">Pendentes</option>
                        <option value="atrasadas">Atrasadas</option>
                    </select>
                </div>

                <div class="filtro-grupo filtro-ordenacao">
                    <label for="filtro-ordenacao">Ordenar:</label>
                    <select id="filtro-ordenacao" class="form-control">
                        <option value="data">Data</option>
                        <option value="valor-desc">Maior Valor</option>
                        <option value="valor-asc">Menor Valor</option>
                        <option value="categoria">Categoria</option>
                        <option value="forma-pagamento">Pagamento</option>
                        <option value="descricao">Descrição</option>
                    </select>
                </div>
            </div>

            <!-- PERÍODO PERSONALIZADO -->
            <div id="periodo-personalizado-container" class="periodo-personalizado-ultra-compacto hidden">
                <label for="data-inicio-relatorio">De:</label>
                <input type="date" id="data-inicio-relatorio" class="form-input">
                <label for="data-fim-relatorio">Até:</label>
                <input type="date" id="data-fim-relatorio" class="form-input">
            </div>
            <!-- LINHA 2: Checkboxes -->
            <div class="filtros-linha filtros-linha-checkboxes-inline">
                <div class="grupo-checkboxes-completo">
                    <span class="grupo-label">Pagamento:</span>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="forma-todas" value="todas" checked>
                        <span>Todas</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="forma-pix" value="pix">
                        <span>PIX</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="forma-debito" value="debito">
                        <span>Débito</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="forma-dinheiro" value="dinheiro">
                        <span>Dinheiro</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="forma-credito" value="credito">
                        <span>Crédito</span>
                    </label>

                    <span class="grupo-label grupo-label-separador">Opções:</span>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="incluir-transferencias">
                        <span>Transferências</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="agrupar-parcelamentos">
                        <span>Agrupar</span>
                    </label>
                    <label class="checkbox-mini">
                        <input type="checkbox" id="mostrar-projecoes">
                        <span>Projeções</span>
                    </label>
                </div>
            </div>
            <div id="resumo-filtros-aplicados" class="filtros-resumo hidden">
                <h4>Filtros Aplicados:</h4>
                <div id="texto-filtros-resumo"></div>
            </div>
            <div class="filtros-acoes">
                <button id="btn-gerar-relatorio" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    Gerar Relatório
                </button>
                <button id="btn-limpar-filtros-relatorio" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Limpar Filtros
                </button>
                <button id="btn-exportar-pdf-relatorio" class="btn btn-success" disabled>
                    <i class="fas fa-file-pdf"></i>
                    Exportar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- RESULTADOS DOS RELATÓRIOS -->
    <div class="relatorios-resultados">
        <!-- Resumo Executivo -->
        <div id="resumo-executivo" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-chart-line"></i> Resumo Executivo</h3>
            </div>
            <div class="resumo-cards">
                <div class="resumo-card receitas">
                    <div class="card-header">
                        <i class="fas fa-arrow-up"></i>
                        <span>Total de Receitas</span>
                    </div>
                    <div class="card-valor" id="resumo-total-receitas">R$ 0,00</div>
                    <div class="card-info" id="resumo-count-receitas">0 transações</div>
                </div>
                
                <div class="resumo-card despesas">
                    <div class="card-header">
                        <i class="fas fa-arrow-down"></i>
                        <span>Total de Despesas</span>
                    </div>
                    <div class="card-valor" id="resumo-total-despesas">R$ 0,00</div>
                    <div class="card-info" id="resumo-count-despesas">0 transações</div>
                </div>
                
                <div class="resumo-card saldo">
                    <div class="card-header">
                        <i class="fas fa-balance-scale"></i>
                        <span>Saldo Líquido</span>
                    </div>
                    <div class="card-valor" id="resumo-saldo-liquido">R$ 0,00</div>
                    <div class="card-info" id="resumo-economia">0% de economia</div>
                </div>
                
                <div class="resumo-card juros">
                    <div class="card-header">
                        <i class="fas fa-percentage"></i>
                        <span>Juros Pagos</span>
                    </div>
                    <div class="card-valor" id="resumo-total-juros">R$ 0,00</div>
                    <div class="card-info" id="resumo-percent-juros">0% do total</div>
                </div>
            </div>
        </div>

        <!-- Comparativo por Forma de Pagamento -->
        <div id="comparativo-formas-pagamento" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-chart-bar"></i> Comparativo por Forma de Pagamento</h3>
            </div>
            <div class="comparativo-cards">
                <div class="comparativo-card pix">
                    <div class="card-header">
                        <i class="fas fa-mobile-alt"></i>
                        <span>PIX</span>
                    </div>
                    <div class="card-valor" id="comparativo-pix-valor">R$ 0,00</div>
                    <div class="card-info">
                        <span id="comparativo-pix-count">0 transações</span>
                        <span id="comparativo-pix-percent">0%</span>
                    </div>
                </div>
                
                <div class="comparativo-card debito">
                    <div class="card-header">
                        <i class="fas fa-credit-card"></i>
                        <span>Débito</span>
                    </div>
                    <div class="card-valor" id="comparativo-debito-valor">R$ 0,00</div>
                    <div class="card-info">
                        <span id="comparativo-debito-count">0 transações</span>
                        <span id="comparativo-debito-percent">0%</span>
                    </div>
                </div>

                <div class="comparativo-card dinheiro">
                    <div class="card-header">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Dinheiro</span>
                    </div>
                    <div class="card-valor" id="comparativo-dinheiro-valor">R$ 0,00</div>
                    <div class="card-info">
                        <span id="comparativo-dinheiro-count">0 transações</span>
                        <span id="comparativo-dinheiro-percent">0%</span>
                    </div>
                </div>

                <div class="comparativo-card credito">
                    <div class="card-header">
                        <i class="fas fa-credit-card"></i>
                        <span>Crédito</span>
                    </div>
                    <div class="card-valor" id="comparativo-credito-valor">R$ 0,00</div>
                    <div class="card-info">
                        <span id="comparativo-credito-count">0 transações</span>
                        <span id="comparativo-credito-percent">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Análise de Gastos Reais -->
        <div id="analise-gastos-reais" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-calculator"></i> Análise de Gastos Reais</h3>
            </div>
            <div class="gastos-reais-cards">
                <div class="gasto-real-card total">
                    <div class="card-header">
                        <i class="fas fa-coins"></i>
                        <span>Total Gasto no Período</span>
                    </div>
                    <div class="card-valor" id="total-gastos-reais">R$ 0,00</div>
                    <div class="card-info" id="gastos-reais-criterio">Por data de vencimento</div>
                </div>
                
                <div class="gasto-real-card media">
                    <div class="card-header">
                        <i class="fas fa-calendar-day"></i>
                        <span>Média Diária</span>
                    </div>
                    <div class="card-valor" id="media-diaria-gastos">R$ 0,00</div>
                    <div class="card-info" id="dias-periodo">0 dias</div>
                </div>
                
                <div class="gasto-real-card maior">
                    <div class="card-header">
                        <i class="fas fa-arrow-up"></i>
                        <span>Maior Gasto</span>
                    </div>
                    <div class="card-valor" id="maior-gasto-periodo">R$ 0,00</div>
                    <div class="card-info" id="maior-gasto-descricao">-</div>
                </div>
            </div>
        </div>

        <!-- Detalhamento por Categoria -->
        <div id="detalhamento-categorias" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-tags"></i> Detalhamento por Categoria</h3>
            </div>
            <div class="tabela-responsiva">
                <table class="relatorio-tabela">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Receitas</th>
                            <th>Despesas</th>
                            <th>Saldo</th>
                            <th>% do Total</th>
                            <th>Transações</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-categorias-body">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Detalhamento por Forma de Pagamento -->
        <div id="detalhamento-pagamento" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-credit-card"></i> Detalhamento por Forma de Pagamento</h3>
            </div>
            <div class="pagamento-resumo">
                <div class="pagamento-item pix">
                    <div class="pagamento-header">
                        <i class="fas fa-mobile-alt"></i>
                        <span>PIX</span>
                    </div>
                    <div class="pagamento-valor" id="pagamento-pix-valor">R$ 0,00</div>
                    <div class="pagamento-info">
                        <span id="pagamento-pix-count">0 transações</span>
                        <span id="pagamento-pix-percent">0%</span>
                    </div>
                </div>
                
                <div class="pagamento-item debito">
                    <div class="pagamento-header">
                        <i class="fas fa-credit-card"></i>
                        <span>Débito</span>
                    </div>
                    <div class="pagamento-valor" id="pagamento-debito-valor">R$ 0,00</div>
                    <div class="pagamento-info">
                        <span id="pagamento-debito-count">0 transações</span>
                        <span id="pagamento-debito-percent">0%</span>
                    </div>
                </div>

                <div class="pagamento-item dinheiro">
                    <div class="pagamento-header">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Dinheiro</span>
                    </div>
                    <div class="pagamento-valor" id="pagamento-dinheiro-valor">R$ 0,00</div>
                    <div class="pagamento-info">
                        <span id="pagamento-dinheiro-count">0 transações</span>
                        <span id="pagamento-dinheiro-percent">0%</span>
                    </div>
                </div>

                <div class="pagamento-item credito">
                    <div class="pagamento-header">
                        <i class="fas fa-credit-card"></i>
                        <span>Crédito</span>
                    </div>
                    <div class="pagamento-valor" id="pagamento-credito-valor">R$ 0,00</div>
                    <div class="pagamento-info">
                        <span id="pagamento-credito-count">0 transações</span>
                        <span id="pagamento-credito-percent">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Transações -->
        <div id="lista-transacoes" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-list"></i> Lista de Transações</h3>
                <div class="transacoes-info">
                    <p id="transacoes-count-info">Mostrando 0 transações</p>
                </div>
            </div>
            <div class="tabela-responsiva">
                <table class="relatorio-tabela">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Categoria</th>
                            <th>Forma Pagamento</th>
                            <th>Valor</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-transacoes-body">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Detalhamento de Parcelamentos -->
        <div id="detalhamento-parcelamentos" class="resultado-secao hidden">
            <div class="secao-header">
                <h3><i class="fas fa-credit-card"></i> Parcelamentos</h3>
            </div>
            <div class="tabela-responsiva">
                <table class="relatorio-tabela">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th>Valor Total</th>
                            <th>Parcelas</th>
                            <th>Valor/Parcela</th>
                            <th>Pagas</th>
                            <th>Restantes</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-parcelamentos-body">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mensagem Sem Dados -->
        <div id="sem-dados-mensagem" class="sem-dados hidden">
            <div class="sem-dados-icon">
                <i class="fas fa-search"></i>
            </div>
            <h4>Nenhum dado encontrado</h4>
            <p>Não foram encontradas transações para os filtros selecionados. Tente ajustar os critérios de busca.</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="relatorios-loading" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
    </div>
</section>


<!-- ================================================== -->
<!-- SEÇÃO DE CONFIGURAÇÕES -->
<!-- ================================================== -->
<section class="config-section" id="config-section">
       
    <div class="config-tabs">
       <button class="config-tab-btn active" data-tab="usuarios">
            <i class="fas fa-users"></i> Usuários
        </button>
         <button class="config-tab-btn" data-tab="cartoes">
            <i class="fas fa-credit-card"></i> Cartões de Crédito
        </button>
         <button class="config-tab-btn" data-tab="categorias">
            <i class="fas fa-tags"></i> Gerenciar Categorias
        </button>        
        <button class="config-tab-btn" data-tab="logs">
            <i class="fas fa-history"></i> Logs do Sistema
        </button>
        <button class="config-tab-btn" data-tab="sistema">
            <i class="fas fa-cogs"></i> Sistema
        </button>
    </div>
    
    <div class="config-tab-content">

        <!-- ============================================== -->
        <!-- ABA: GERENCIAMENTO DE CATEGORIAS -->
        <!-- ============================================== -->
        <div id="categorias-tab" class="config-tab-pane">
            <div class="config-card">
                
                <div class="form-add-categoria">
                    <input type="text" id="nova-categoria-nome" placeholder="Nome da categoria" maxlength="50">
                    <button id="btn-adicionar-categoria" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="tabela-categorias">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome da Categoria</th>
                                <th>Data de Criação</th>
                                <th>Última Edição</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-categorias">
                            <!-- Categorias serão inseridas aqui -->
                        </tbody>
                    </table>
                </div>

                <!-- Mensagem quando não há categorias -->
                <div id="sem-categorias-message" class="notification-empty hidden">
                    <i class="fas fa-tags"></i>
                    <p>Nenhuma categoria encontrada</p>
                </div>
            </div>
            
            <div class="config-card info-card">
                <h3><i class="fas fa-info-circle"></i> Dicas</h3>
                <ul>
                    <li>Use categorias específicas para melhor organizar suas finanças</li>
                    <li>Você pode identificar a <strong>forma de pagamento</strong> (PIX, Débito, Crédito) diretamente no formulário de despesas</li>
                    <li>Todas as despesas da mesma categoria são agrupadas nos gráficos, independente da forma de pagamento</li>
                    <li>Categorias bem definidas melhoram a visualização nos relatórios</li>
                    <li>Você pode analisar seus gastos tanto por categoria quanto por forma de pagamento</li>
                </ul>
            </div>
        </div>
        
        <!-- ============================================== -->
        <!-- ABA: CONFIGURAÇÕES DO SISTEMA -->
        <!-- ============================================== -->
        <div id="sistema-tab" class="config-tab-pane">
            <div class="config-card">
                               
                <div class="form-group">
                    <h4><i class="fas fa-download"></i> Backup e Restauração</h4>
                    <div class="btn-group">
                        <button id="btn-exportar-dados" class="btn btn-primary">
                            <i class="fas fa-download"></i> Exportar Todos os Dados
                        </button>
                        <button id="btn-exportar-mes-a-mes" class="btn btn-primary">
                            <i class="fas fa-calendar-alt"></i> Exportar Mês a Mês
                        </button>
                        <button id="btn-importar-dados" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Importar Dados
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4><i class="fas fa-trash-alt"></i> Limpeza de Dados</h4>
                    <button id="btn-limpar-dados" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Limpar Todos os Dados
                    </button>
                    <p class="texto-alerta">⚠️ Atenção: Esta ação é irreversível!</p>
                </div>
            </div>
            

            <!-- Status de operações do sistema -->
            <div id="sistema-status" class="config-card hidden">
                <h3><i class="fas fa-info-circle"></i> Status da Operação</h3>
                <div class="status-container">
                    <div id="status-message" class="status-message"></div>
                    <div id="status-progress" class="status-progress hidden">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ============================================== -->
        <!-- ABA: GERENCIAMENTO DE USUÁRIOS INTEGRADA -->
        <!-- ============================================== -->
        <div id="usuarios-tab" class="config-tab-pane active">
            <div class="config-card">
               
                <!-- Controles de Usuários Integrados -->
                <div class="user-management-controls">
                    <div class="search-container">
                        <input type="text" id="usuario-search" placeholder="Buscar usuário..." maxlength="100">
                        <button id="btn-search-user" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <div class="filter-container">
                        <select id="filter-user-type" class="form-control">
                            <option value="todos">Todos os usuários</option>
                            <option value="master">Master</option>
                            <option value="admin">Administradores</option>
                            <option value="padrao">Usuários padrão</option>
                        </select>
                    </div>
                    
                    <button id="btn-adicionar-usuario" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Novo Usuário
                    </button>
                </div>

                <!-- Tabela de Usuários Integrada -->
                <div class="table-responsive">
                    <table class="tabela-usuarios">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Documento</th>
                                <th>E-mail</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-usuarios">
                            <!-- Preenchido dinamicamente via template -->
                        </tbody>
                    </table>
                </div>

                <!-- Mensagem quando não há usuários -->
                <div id="no-users-message" class="notification-empty hidden">
                    <i class="fas fa-users-slash"></i>
                    <p>Nenhum usuário encontrado</p>
                </div>

                <!-- Controles de Paginação -->
                <div class="pagination-controls">
                    <button id="btn-prev-page" class="btn btn-secondary btn-sm" disabled>
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <span id="pagination-info">Página 1 de 1</span>
                    <button id="btn-next-page" class="btn btn-secondary btn-sm" disabled>
                        Próxima <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Card de Informações de Segurança -->
            <div class="config-card info-card">
                <h3><i class="fas fa-shield-alt"></i> Segurança</h3>
                <p>O gerenciamento de usuários permite controlar quem tem acesso ao sistema e quais ações cada usuário pode realizar.</p>
                <ul>
                    <li>Apenas usuários Master podem adicionar novos usuários</li>
                    <li>Usuários Master têm acesso total às configurações do sistema</li>
                    <li>Administradores só podem editar usuários do tipo Padrão</li>
                    <li>A exclusão de usuários também remove todos os seus dados</li>
                    <li>Cada usuário possui suas próprias categorias personalizadas</li>
                </ul>
            </div>
        </div>

       <div id="cartoes-tab" class="config-tab-pane">
    <div class="config-card">

        <div class="form-add-cartao">
            <input type="text" id="novo-cartao-banco" placeholder="Nome do Banco" maxlength="50">
            <input type="number" id="novo-cartao-fechamento" placeholder="Dia Fechamento" min="1" max="31">
            <input type="number" id="novo-cartao-vencimento" placeholder="Dia Vencimento" min="1" max="31">
            <input type="number" id="novo-cartao-limite" placeholder="Limite (R$)" step="0.01" min="0">
            <button id="btn-adicionar-cartao" class="btn btn-primary">
                <i class="fas fa-plus"></i> Adicionar Cartão
            </button>
        </div>

        <div class="lista-cartoes-container">
            <table id="tabela-cartoes" class="tabela-cartoes">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Banco</th>
                        <th>Fech/Venc</th>
                        <th>Limite</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="lista-cartoes">
                    <!-- Cartões serão inseridos aqui dinamicamente -->
                </tbody>
            </table>
        </div>

        <div id="cartoes-status" class="status-feedback hidden">
            <div class="feedback-message">
                <i class="feedback-icon"></i>
                <span class="feedback-text"></span>
            </div>
        </div>
    </div>
    
    <div class="config-card info-card">
        <h3><i class="fas fa-info-circle"></i> Dicas sobre Cartões</h3>
        <ul>
            <li>Mantenha sempre o controle dos limites dos seus cartões</li>
            <li>Verifique regularmente as datas de validade</li>
            <li>Use o checkbox "Ativo" para cartões que você realmente utiliza</li>
        </ul>
    </div>
</div>

        <!-- ============================================== -->
        <!-- ABA: LOGS DO SISTEMA -->
        <!-- ============================================== -->
        <div id="logs-tab" class="config-tab-pane">
            <div class="config-card">
              
                <!-- Filtros -->
                <div class="logs-filtros">
                    <div class="filtro-grupo">
                        <label for="filtro-modulo">Módulo:</label>
                        <select id="filtro-modulo" class="form-control">
                            <option value="todos">Todos</option>
                            <option value="Receitas">Receitas</option>
                            <option value="Despesas">Despesas</option>
                            <option value="Configurações">Configurações</option>
                        </select>
                    </div>

                    <div class="filtro-grupo">
                        <label for="filtro-data-inicio">Data Início:</label>
                        <input type="date" id="filtro-data-inicio" class="form-input">
                    </div>

                    <div class="filtro-grupo">
                        <label for="filtro-data-fim">Data Fim:</label>
                        <input type="date" id="filtro-data-fim" class="form-input">
                    </div>

                    <div class="filtro-grupo">
                        <label for="filtro-acao">Ação:</label>
                        <select id="filtro-acao" class="form-control">
                            <option value="todos">Todas</option>
                            <option value="criado">Criado</option>
                            <option value="editado">Editado</option>
                            <option value="excluído">Excluído</option>
                        </select>
                    </div>

                    <div class="filtro-grupo">
                        <label for="filtro-busca">Buscar:</label>
                        <input type="text" id="filtro-busca" class="form-input" placeholder="Descrição, categoria...">
                    </div>

                    <div class="filtro-acoes">
                        <button id="btn-filtrar-logs" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Filtrar
                        </button>
                        <button id="btn-limpar-filtros-logs" class="btn btn-secondary">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                        <button id="btn-exportar-logs" class="btn btn-info">
                            <i class="fas fa-download"></i> Exportar CSV
                        </button>
                        <button id="btn-limpar-todos-logs" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Limpar Logs
                        </button>
                    </div>
                </div>

                <!-- Tabela de Logs -->
                <div class="lista-logs-container">
                    <table id="tabela-logs" class="tabela-logs">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Hora</th>
                                <th>Módulo</th>
                                <th>Ação</th>
                                <th>Usuário</th>
                                <th>Categoria</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody id="lista-logs">
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>

                <!-- Mensagem quando não há logs -->
                <div id="sem-logs-message" class="empty-state hidden">
                    <i class="fas fa-inbox"></i>
                    <p>Nenhum log encontrado</p>
                    <small>As ações realizadas no sistema aparecerão aqui</small>
                </div>
            </div>
        </div>

    </div>
</section>

</div> <!-- /.content-area -->


<!-- ================================================== -->
<!-- TODOS OS MODAIS DE CONFIGURAÇÕES -->
<!-- ================================================== -->

<!-- Modal: Editar Categoria -->
<div id="modal-editar-categoria" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Editar Categoria</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-editar-categoria">
                <input type="hidden" id="categoria-edit-id">

                <div class="form-group">
                    <label for="categoria-edit-nome">
                        <i class="fas fa-tag"></i> Nome da Categoria: <span class="required">*</span>
                    </label>
                    <input type="text" id="categoria-edit-nome" class="form-input" required maxlength="50">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">
                Cancelar
            </button>
            <button type="submit" form="form-editar-categoria" class="btn btn-primary">
                Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal: Editar Cartão -->
<div id="modal-editar-cartao" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2><i class="fas fa-credit-card"></i> Editar Cartão</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-editar-cartao">
                <input type="hidden" id="cartao-edit-id">

                <div class="form-row-cartao">
                    <div class="form-group flex-grow">
                        <label for="cartao-edit-banco">
                            <i class="fas fa-university"></i> Nome do Banco <span class="required">*</span>
                        </label>
                        <input type="text" id="cartao-edit-banco" class="form-input" required maxlength="50" placeholder="Ex: Nubank, Itaú, etc.">
                    </div>
                    <div class="form-group form-group-checkbox">
                        <label>Ativo</label>
                        <div class="checkbox-container">
                            <input type="checkbox" id="cartao-edit-ativo">
                        </div>
                    </div>
                </div>

                <div class="form-row-cartao">
                    <div class="form-group">
                        <label for="cartao-edit-fechamento">
                            <i class="fas fa-calendar-alt"></i> Dia Fechamento <span class="required">*</span>
                        </label>
                        <input type="number" id="cartao-edit-fechamento" class="form-input" min="1" max="31" required placeholder="1-31">
                    </div>
                    <div class="form-group">
                        <label for="cartao-edit-vencimento">
                            <i class="fas fa-calendar-check"></i> Dia Vencimento <span class="required">*</span>
                        </label>
                        <input type="number" id="cartao-edit-vencimento" class="form-input" min="1" max="31" required placeholder="1-31">
                    </div>
                    <div class="form-group">
                        <label for="cartao-edit-limite">
                            <i class="fas fa-dollar-sign"></i> Limite (R$) <span class="required">*</span>
                        </label>
                        <input type="number" id="cartao-edit-limite" class="form-input" step="0.01" min="0" required placeholder="0,00">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">
                Cancelar
            </button>
            <button type="submit" form="form-editar-cartao" class="btn btn-primary">
                Salvar
            </button>
        </div>
    </div>
</div>


<!-- Modal: Adicionar Usuário -->
<div id="modal-adicionar-usuario" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2>Novo Usuário</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-adicionar-usuario">
                <div class="form-group">
                    <label for="novo-usuario-nome">Nome <span class="required">*</span></label>
                    <input type="text" id="novo-usuario-nome" class="form-input" required maxlength="100">
                </div>

                <div class="form-group">
                    <label for="novo-usuario-email">E-mail <span class="required">*</span></label>
                    <input type="email" id="novo-usuario-email" class="form-input" required maxlength="100">
                </div>

                <div class="form-group">
                    <label for="novo-usuario-documento">Documento (CPF/CNPJ) <span class="required">*</span></label>
                    <input type="text" id="novo-usuario-documento" class="form-input" required maxlength="18">
                    <small class="field-help">Digite apenas números</small>
                </div>

                <div class="form-group">
                    <label for="novo-usuario-tipo">Tipo de Usuário</label>
                    <select id="novo-usuario-tipo" class="form-control">
                        <option value="padrao">Usuário Padrão</option>
                        <option value="admin">Administrador</option>
                        <option value="master">Master</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="novo-usuario-senha">Senha <span class="required">*</span></label>
                    <input type="password" id="novo-usuario-senha" class="form-input" required minlength="6">
                    <small class="field-help">Mínimo 6 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="novo-usuario-confirmar-senha">Confirmar Senha <span class="required">*</span></label>
                    <input type="password" id="novo-usuario-confirmar-senha" class="form-input" required minlength="6">
                </div>

                <!-- Status de validação -->
                <div id="validacao-status" class="validation-feedback hidden">
                    <div class="validation-message">
                        <i class="validation-icon"></i>
                        <span class="validation-text"></span>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">Cancelar</button>
            <button type="submit" form="form-adicionar-usuario" class="btn btn-primary">Salvar</button>
        </div>
    </div>
</div>

<!-- Modal: Editar Usuário -->
<div id="modal-editar-usuario" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2 id="editar-usuario-titulo">Editar Usuário</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-editar-usuario">
                <input type="hidden" id="editar-usuario-id">

                <div class="form-group">
                    <label for="editar-usuario-nome">Nome <span class="required">*</span></label>
                    <input type="text" id="editar-usuario-nome" class="form-input" required maxlength="100">
                </div>

                <div class="form-group">
                    <label for="editar-usuario-email">E-mail <span class="required">*</span></label>
                    <input type="email" id="editar-usuario-email" class="form-input" required maxlength="100">
                </div>

                <div class="form-group">
                    <label for="editar-usuario-documento">Documento (CPF/CNPJ) <span class="required">*</span></label>
                    <input type="text" id="editar-usuario-documento" class="form-input" required maxlength="18" disabled>
                    <small class="field-help">O documento não pode ser alterado após o cadastro</small>
                </div>

                <div id="form-group-tipo" class="form-group">
                    <label for="editar-usuario-tipo">Tipo de Usuário</label>
                    <select id="editar-usuario-tipo" class="form-control">
                        <option value="padrao">Usuário Padrão</option>
                        <option value="admin">Administrador</option>
                        <option value="master">Master</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editar-usuario-status">Status</label>
                    <select id="editar-usuario-status" class="form-control">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="bloqueado">Bloqueado</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editar-usuario-senha">Nova Senha</label>
                    <input type="password" id="editar-usuario-senha" class="form-input" placeholder="Deixe em branco para manter a atual" minlength="6">
                    <small class="field-help">Mínimo 6 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="editar-usuario-confirmar-senha">Confirmar Nova Senha</label>
                    <input type="password" id="editar-usuario-confirmar-senha" class="form-input" placeholder="Confirme a nova senha">
                </div>

                <!-- Mensagem de permissão -->
                <div id="permissao-message" class="alert-message hidden">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Você só pode editar usuários do tipo Padrão</span>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">Cancelar</button>
            <button type="submit" form="form-editar-usuario" class="btn btn-primary">Salvar</button>
        </div>
    </div>
</div>

<!-- Modal: Confirmação de Exclusão de Usuário -->
<div id="modal-confirmar-exclusao-usuario" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div class="confirmacao-exclusao">
                <div class="warning-message">
                    <i class="fas fa-user-times"></i>
                    <p>Tem certeza que deseja excluir o usuário <strong id="usuario-nome-exclusao"></strong>?</p>
                </div>
                
                <div class="alert-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>ATENÇÃO:</strong> Todos os dados deste usuário serão perdidos permanentemente. Esta ação não pode ser desfeita.</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-cancelar-exclusao-usuario" class="btn btn-secondary">
                Cancelar
            </button>
            <button id="btn-confirmar-exclusao-usuario" class="btn btn-danger">
                <i class="fas fa-trash"></i> Sim, Excluir
            </button>
        </div>
    </div>
</div>

<!-- Modal: Feedback do Sistema -->
<div id="modal-feedback-sistema" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2 id="feedback-titulo">Mensagem do Sistema</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div id="feedback-conteudo" class="feedback-message">
                <div id="feedback-icone" class="feedback-icon"></div>
                <p id="feedback-texto">Mensagem</p>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-feedback-ok" class="btn btn-primary btn-block">OK</button>
        </div>
    </div>
</div>

<!-- Modal: Alterar Senha -->
<div id="modal-alterar-senha" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2><i class="fas fa-key"></i> Alterar Senha</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-alterar-senha">
                <div class="form-group">
                    <label for="senha-atual-modal">Senha Atual</label>
                    <input type="password" id="senha-atual-modal" class="form-control" placeholder="Digite sua senha atual" required>
                </div>

                <div class="form-group">
                    <label for="senha-nova-modal">Nova Senha</label>
                    <input type="password" id="senha-nova-modal" class="form-control" placeholder="Digite a nova senha" required minlength="6">
                </div>

                <div class="form-group">
                    <label for="senha-confirmar-modal">Confirmar Nova Senha</label>
                    <input type="password" id="senha-confirmar-modal" class="form-control" placeholder="Digite novamente a nova senha" required minlength="6">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">
                Cancelar
            </button>
            <button type="submit" form="form-alterar-senha" class="btn btn-primary">Salvar</button>
        </div>
    </div>
</div>

<!-- ================================================== -->
<!-- TEMPLATES PARA REUTILIZAÇÃO -->
<!-- ================================================== -->

<!-- Template: Linha de Categoria -->
<template id="template-linha-categoria">
    <tr class="categoria-row">
        <td class="categoria-id"></td>
        <td class="categoria-nome"></td>
        <td class="categoria-data-criacao"></td>
        <td class="categoria-data-edicao"></td>
        <td class="categoria-acoes">
            <div class="acoes-grupo">
                <button class="btn btn-sm btn-editar-categoria" data-categoria-id="" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-remover-categoria" data-categoria-id="" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>
</template>

<!-- Template: Linha de Usuário -->
<template id="template-linha-usuario">
    <tr class="usuario-row">
        <td class="usuario-nome"></td>
        <td class="usuario-documento"></td>
        <td class="usuario-email"></td>
        <td class="usuario-tipo">
            <span class="tipo-badge"></span>
        </td>
        <td class="usuario-status">
            <span class="status-badge"></span>
        </td>
        <td class="acoes-usuario">
            <div class="acoes-grupo">
                <button class="btn btn-sm btn-editar-usuario" data-index="" title="Editar usuário">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-bloquear-usuario" data-index="" title="Bloquear usuário">
                    <i class="fas fa-ban"></i>
                </button>
                <button class="btn btn-sm btn-excluir-usuario" data-index="" title="Excluir usuário">
                    <i class="fas fa-trash"></i>
                </button>
                <span class="texto-sem-permissao hidden">Sem permissão</span>
            </div>
        </td>
    </tr>
</template>

<!-- Template: Badge de Tipo de Usuário -->
<template id="template-tipo-badge">
    <span class="tipo-badge tipo-padrao">Padrão</span>
</template>

<!-- Template: Badge de Status de Usuário -->
<template id="template-status-badge">
    <span class="status-badge status-ativo">Ativo</span>
</template>

<!-- Template: Mensagem de Status -->
<template id="template-status-message">
    <div class="status-message">
        <i class="status-icon"></i>
        <span class="status-text"></span>
    </div>
</template>

<!-- Template: Mensagem de Validação -->
<template id="template-validation-message">
    <div class="validation-message">
        <i class="validation-icon"></i>
        <span class="validation-text"></span>
    </div>
</template>

<!-- ======================================================== -->
<!-- TELA DE BLOQUEIO -->
<!-- ======================================================== -->
<div id="lock-screen-overlay" class="lock-screen-overlay"></div>
<div id="modal-lock-screen" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2><i class="fas fa-lock"></i> Sistema Bloqueado</h2>
        </div>
        <div class="modal-body">
            <form id="form-lock-screen">
                <div class="form-group">
                    <input type="password" id="lock-screen-password" placeholder="Sua Senha" required>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="submit" form="form-lock-screen" class="btn btn-primary btn-block">
                <i class="fas fa-unlock"></i> Desbloquear
            </button>
        </div>
    </div>
</div>

<!--======================================================== -->
<!-- MODAL: CRIAÇÃO DE ANO FINANCEIRO -->
<!-- ======================================================== -->
<div id="modal-novo-ano" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2>Criar Novo Ano Financeiro</h2>
            <button type="button" class="close" data-modal="modal-novo-ano" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-novo-ano" onsubmit="handleCriarNovoAno(event)">
                <div class="form-group">
                    <label for="ano">Ano:</label>
                    <input type="number" id="ano" min="2000" max="2100" required>
                </div>
                <div class="form-group">
                    <label for="receita-mensal">Receita Mensal Padrão:</label>
                    <input type="number" id="receita-mensal" min="0" step="0.01" placeholder="0.00">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="cancelar">
                Cancelar
            </button>
            <button type="submit" form="form-novo-ano" class="btn btn-primary">
                <i class="fas fa-save"></i> Criar
            </button>
        </div>
    </div>
</div>


<!-- ======================================================== -->
<!-- MODAL: FECHAMENTO AUTOMÁTICO -->
<!-- Notifica quando um mês é fechado automaticamente -->
<!-- ======================================================== -->
<div id="modal-notificacao-fechamento" class="notificacao-fechamento hidden">
    <div class="notificacao-content">
        <div class="notificacao-icon">🔒</div>
        <div class="notificacao-texto">
            <strong id="notificacao-titulo">Mês fechado automaticamente</strong>
            <small id="notificacao-saldo">Saldo transferido: R$ 0,00</small>
        </div>
        <button type="button" class="notificacao-close" title="Fechar">&times;</button>
    </div>
</div>

<!-- ======================================================== -->
<!-- MODAL: DETALHES MENSAIS -->
<!-- ======================================================== -->
<div id="modal-detalhes-mes" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h2 id="detalhes-mes-titulo">Detalhes do Mês</h2>
            <div class="header-navigation">
                <button id="btn-mes-anterior" class="btn btn-navegacao-mes">Anterior</button>
                <button id="btn-mes-proximo" class="btn btn-navegacao-mes">Próximo</button>
            </div>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
           <!-- TOOLBAR UNIFICADA -->
           <div class="tabs-toolbar">
                <!-- Lado esquerdo: Abas + Ações -->
                <div class="toolbar-esquerda">
                    <!-- Abas de navegação -->
                    <div class="tabs-nav">
                        <button class="tab-btn active" data-tab="tab-resumo">Resumo</button>
                        <button class="tab-btn" data-tab="tab-despesas">Despesas</button>
                        <button class="tab-btn" data-tab="tab-receitas">Receitas</button>
                    </div>
                    <span class="toolbar-divider"></span>
                    <!-- Ações contextuais: Despesas -->
                    <div class="toolbar-acoes" data-for-tab="tab-despesas">
                        <button id="btn-nova-despesa-toolbar" class="btn btn-danger btn-sm" title="Nova Despesa">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="btn-pagar-lote-toolbar" class="btn btn-secondary btn-sm" disabled title="Pagar em Lote">
                            <i class="fas fa-check-circle"></i> Lote
                        </button>
                        <span class="toolbar-divider"></span>
                    </div>
                    <!-- Ações contextuais: Receitas -->
                    <div class="toolbar-acoes" data-for-tab="tab-receitas">
                        <button id="btn-nova-receita-toolbar" class="btn btn-success btn-sm" title="Nova Receita">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="btn-reservas-toolbar" class="btn btn-secondary btn-sm" title="Reservas">
                            <i class="fas fa-piggy-bank"></i>
                        </button>
                        <span class="toolbar-divider"></span>
                    </div>
                </div>

                <!-- Lado direito: Filtros e Informações -->
                <div class="toolbar-direita">
                    <!-- Conteúdo contextual: Resumo (vazio) -->
                    <div class="tab-toolbar-content active" data-for-tab="tab-resumo">
                    </div>

                    <!-- Conteúdo contextual: Despesas -->
                    <div class="tab-toolbar-content" data-for-tab="tab-despesas">
                        <select id="filtro-categoria-toolbar" class="form-control form-control-sm">
                            <option value="todas">Categorias</option>
                        </select>
                        <select id="filtro-forma-pagamento-toolbar" class="form-control form-control-sm">
                            <option value="todas">Pagamento</option>
                            <option value="pix">PIX</option>
                            <option value="debito">Débito</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Crédito</option>
                        </select>
                        <select id="filtro-status-toolbar" class="form-control form-control-sm">
                            <option value="todas">Status</option>
                            <option value="em_dia">Em Dia</option>
                            <option value="atrasada">Atrasadas</option>
                            <option value="pagas">Pagas</option>
                            <option value="pendentes">Pendentes</option>
                        </select>
                        <button id="btn-limpar-filtros-toolbar" class="btn btn-secondary btn-sm" title="Limpar Filtros">
                            <i class="fas fa-eraser"></i>
                        </button>
                        <span id="contador-despesas-toolbar" class="toolbar-contador">0 itens</span>
                        <span id="total-despesas-toolbar" class="toolbar-contador toolbar-total">R$ 0,00</span>
                    </div>

                    <!-- Conteúdo contextual: Receitas -->
                    <div class="tab-toolbar-content" data-for-tab="tab-receitas">
                        <div class="toolbar-saldos">
                            <span class="toolbar-saldo-item">
                                <i class="fas fa-wallet"></i>
                                <span id="toolbar-saldo-atual">R$ 0,00</span>
                            </span>
                            <span class="toolbar-separator">|</span>
                            <span class="toolbar-saldo-item reservado">
                                <i class="fas fa-piggy-bank"></i>
                                <span id="toolbar-reservado">R$ 0,00</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA RESUMO -->
            <div id="tab-resumo" class="tab-content active">
                <div class="resumo-cards">
                    <div class="card card-receitas">
                        <div class="card-header">
                            <i class="fas fa-arrow-up"></i>
                            <span>RECEITAS MÊS ATUAL</span>
                        </div>
                        <div class="card-value" id="resumo-receitas">R$ 0,00</div>
                        <div class="card-footer">Total de receitas cadastradas no mês</div>
                    </div>
                    <div class="card card-despesas">
                        <div class="card-header">
                            <i class="fas fa-arrow-down"></i>
                            <span>DESPESAS MÊS ATUAL</span>
                        </div>
                        <div class="card-value" id="resumo-despesas">R$ 0,00</div>
                        <div class="card-footer">Total de despesas do mês</div>
                    </div>
                    <div class="card card-saldo">
                        <div class="card-header">
                            <i class="fas fa-wallet"></i>
                            <span>SALDO ATUAL MÊS</span>
                        </div>
                        <div class="card-value" id="resumo-saldo">R$ 0,00</div>
                        <div class="card-footer">Receitas - Despesas + Acumulado anterior</div>
                    </div>
                    <div class="card card-juros">
                        <div class="card-header">
                            <i class="fas fa-percentage"></i>
                            <span>JUROS PAGOS</span>
                        </div>
                        <div class="card-value" id="resumo-juros">R$ 0,00</div>
                        <div class="card-footer">Total de juros pagos no mês</div>
                    </div>
                    <div class="card card-economias">
                        <div class="card-header">
                            <i class="fas fa-piggy-bank"></i>
                            <span>ECONOMIAS</span>
                        </div>
                        <div class="card-value" id="resumo-economias">R$ 0,00</div>
                        <div class="card-footer">Valor economizado no mês</div>
                    </div>
                </div>
                
                <!-- Barras de Limite dos Cartões -->
                <div id="limites-cartoes-container" class="limites-cartoes-container">
                    <h3><i class="fas fa-credit-card"></i> Limites dos Cartões</h3>

                    <div id="lista-barras-cartoes" class="lista-barras-cartoes">
                        <!-- Cartões serão inseridos dinamicamente aqui -->
                    </div>
                </div>
            </div>

            <!-- ABA RECEITAS -->
            <div id="tab-receitas" class="tab-content">
                <div class="tabela-receitas-container">
                    <table class="tabela-receitas" id="tabela-receitas">
                        <thead>
                            <tr>
                                <th class="col-id">ID</th>
                                <th class="col-descricao">Descrição</th>
                                <th class="col-valor">Valor</th>
                                <th class="col-data">Data</th>
                                <th class="col-parcela">Parcela</th>
                                <th class="col-acoes">Ações</th>
                                <th class="col-anexos">Anexos</th>
                            </tr>
                        </thead>
                        <tbody id="lista-receitas">
                            <!-- Receitas serão inseridas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ABA DESPESAS -->
            <div id="tab-despesas" class="tab-content">
                <!-- Conteúdo gerado dinamicamente pelo despesas.js -->
            </div>

        </div>
    </div>
</div>

<!-- ================================================================ -->
<!-- TEMPLATES PARA RECEITAS  -->
<!-- ================================================================ -->

<template id="template-linha-receita">
    <tr class="receita-row" data-categoria="">
        <td class="col-id"><span class="receita-id"></span></td>
        <td class="col-descricao"><span class="receita-descricao"></span></td>
        <td class="col-valor"><span class="receita-valor"></span></td>
        <td class="col-data"><span class="receita-data"></span></td>
        <td class="col-parcela"><span class="receita-parcela"></span></td>
        <td class="col-acoes">
            <div class="acoes-grupo">
                <button class="btn btn-sm btn-editar" data-index="" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-excluir" data-index="" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
        <td class="col-anexos">
            <button class="btn btn-anexos" data-index="" title="Ver anexos">
                <i class="fas fa-paperclip"></i>
                <span class="contador-anexos">0</span>
            </button>
        </td>
    </tr>
</template>

<template id="template-linha-saldo-anterior">
    <tr class="saldo-anterior-row">
        <td class="col-id">-</td>
        <td class="col-descricao"><span class="saldo-anterior-desc"></span></td>
        <td class="col-valor"><span class="saldo-anterior-valor"></span></td>
        <td class="col-data">-</td>
        <td class="col-parcela">-</td>
        <td class="col-acoes"><span class="badge-saldo-anterior">AUTOMÁTICO</span></td>
        <td class="col-anexos">-</td>
    </tr>
</template>

<template id="template-reserva-mini">
    <div class="reserva-mini-item">
        <div class="reserva-icon">
            <i class="fas fa-lock"></i>
        </div>
        <div class="reserva-info">
            <span class="reserva-descricao"></span>
            <span class="reserva-data-mini"></span>
        </div>
        <span class="reserva-valor-mini"></span>
        <button class="btn btn-remover-reserva-mini" title="Remover reserva">
            <i class="fas fa-times"></i>
        </button>
    </div>
</template>

        </div>
      </div>
    </div>


<!-- ======================================================== -->
<!-- TEMPLATES -->
<!-- ======================================================== -->

<!-- Template para linha de saldo anterior -->
<template id="template-linha-saldo-anterior">
    <tr class="saldo-anterior-row">
        <td class="col-id">-</td>
        <td class="col-descricao"><span class="saldo-anterior-desc"></span></td>
        <td class="col-valor"><span class="saldo-anterior-valor"></span></td>
        <td class="col-data">-</td>
        <td class="col-parcela">-</td>
        <td class="col-acoes"><span class="badge-saldo-anterior">AUTOMÁTICO</span></td>
        <td class="col-anexos">-</td>
    </tr>
</template>

<!-- ======================================================== -->
<!-- MODAL: CADASTRO DE RECEITAS -->
<!-- ======================================================== -->
<div id="modal-nova-receita" class="modal modal-nova-receita">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2>Nova Receita</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-nova-receita">
                <input type="hidden" id="receita-id">
                <input type="hidden" id="receita-mes">
                <input type="hidden" id="receita-ano">
                
                <div class="form-group form-group-full">
                    <label for="receita-descricao">Descrição:</label>
                    <div class="descricao-anexos-container">
                        <input type="text" id="receita-descricao" placeholder="Descrição" required>
                        <button type="button" id="btn-anexar-receita" class="btn btn-anexar">
                            <i class="fas fa-paperclip"></i>Anexos</button>
                    </div>
                </div>
                
                <div id="lista-anexos-receita" class="lista-anexos-container">
                    <!-- Anexos serão inseridos aqui -->
                </div>
                
                <div class="form-row-grid">
                    <div class="form-group campo-valor">
                        <label for="receita-valor">Valor:</label>
                        <input type="number" id="receita-valor" min="0.01" step="0.01" placeholder="0,00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="receita-data">Data:</label>
                        <input type="date" id="receita-data" required>
                    </div>
                </div>
                
                <div id="opcoes-parcelamento-receita" class="hidden">
                    <div class="form-group">
                        <label for="receita-parcelas">Número de Parcelas:</label>
                        <input type="number" id="receita-parcelas" min="2" max="36" value="2" placeholder="Número de Parcelas">
                    </div>
                </div>
                
                <div class="checkboxes-inline">
                    <label class="checkbox-inline">
                        <input type="checkbox" id="receita-replicar" onchange="toggleReplicarReceita()">
                        Replicar até
                    </label>
                    <div id="opcoes-replicacao-detalhes" class="replicar-options hidden">
                        <select id="replicar-ate-mes" class="form-control form-control-sm">
                            <option value="0">Janeiro</option>
                            <option value="1">Fevereiro</option>
                            <option value="2">Março</option>
                            <option value="3">Abril</option>
                            <option value="4">Maio</option>
                            <option value="5">Junho</option>
                            <option value="6">Julho</option>
                            <option value="7">Agosto</option>
                            <option value="8">Setembro</option>
                            <option value="9">Outubro</option>
                            <option value="10">Novembro</option>
                            <option value="11">Dezembro</option>
                        </select>
                        <select id="replicar-ate-ano" class="form-control form-control-sm"></select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-salvar-transacao">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ======================================================== -->
<!-- MODAL: EXCLUSÃO DE RECEITAS -->
<!-- ======================================================== -->
<div id="modal-exclusao-receita" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2>Excluir receita</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <p>Como deseja excluir esta receita?</p>
        </div>
        <div class="modal-footer">
            <button id="btn-excluir-atual" class="btn btn-secondary">
                <i class="fas fa-times"></i> Excluir apenas esta receita
            </button>
            <button id="btn-excluir-todas" class="btn btn-danger">
                <i class="fas fa-trash"></i> Excluir todas com esta descrição
            </button>
        </div>
    </div>
</div>

<!-- ======================================================== -->
<!-- MODAIS DE ANEXOS -->
<!-- ======================================================== -->

<!-- Modal: Visualizar anexos da receita -->
<div id="modal-anexos-receita" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2>Anexos da Receita</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div id="lista-anexos-visualizar" class="lista-anexos-visualizar">
                <!-- Anexos para download serão inseridos aqui -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary close">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>
</div>

<!-- Modal Reservas -->
<div id="modal-reservar-valor" class="modal">
    <div class="modal-content modal-reservas">
        <div class="modal-header">
            <h2><i class="fas fa-piggy-bank"></i> Reservas</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Totalizador -->
            <div class="reservas-totalizador">
                <div class="totalizador-item">
                    <span class="totalizador-label">Total Reservado</span>
                    <span class="totalizador-valor" id="total-reservado">R$ 0,00</span>
                </div>
                <div class="totalizador-item disponivel">
                    <span class="totalizador-label">Saldo Atual Mês</span>
                    <span class="totalizador-valor" id="saldo-atual-mes-reservas">R$ 0,00</span>
                </div>
            </div>

            <!-- Lista de Reservas com campo inline para +/- valor -->
            <div class="reservas-lista-simples" id="lista-reservas">
                <!-- Reservas serão inseridas aqui -->
            </div>

            <!-- Nova Reserva -->
            <div class="nova-reserva-inline">
                <input type="text" id="input-descricao-reserva" class="form-control" placeholder="Nome da reserva" maxlength="50">
                <input type="number" id="input-valor-reserva" class="form-control" placeholder="Valor" step="0.01" min="0.01">
                <button type="button" id="btn-adicionar-reserva" class="btn btn-success" title="Criar reserva">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <!-- Histórico Geral -->
            <div class="historico-geral-container">
                <h4><i class="fas fa-history"></i> Histórico</h4>
                <div class="historico-geral-lista" id="historico-geral-reservas">
                    <div class="historico-vazio">Nenhuma movimentação</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Templates para anexos -->
<template id="template-anexo-item">
    <div class="anexo-item">
        <div class="anexo-info">
            <i class="anexo-icone"></i>
            <span class="anexo-nome"></span>
        </div>
        <button class="btn btn-remover-anexo" data-anexo-id="">
            <i class="fas fa-times"></i>
        </button>
    </div>
</template>

<template id="template-anexo-download">
    <div class="anexo-download-item">
        <div class="anexo-info">
            <i class="anexo-icone"></i>
            <span class="anexo-nome"></span>
        </div>
        <button class="btn btn-download-anexo" data-anexo-id="">
            <i class="fas fa-download"></i>
        </button>
    </div>
</template>





<div id="modal-nova-despesa" class="modal modal-nova-despesa">
   <div class="modal-content modal-md">
       <div class="modal-header">
           <h2>Nova Despesa</h2>
           <button type="button" class="close" data-modal="modal-nova-despesa" title="Fechar">&times;</button>
       </div>
       <div class="modal-body">
           <form id="form-nova-despesa" onsubmit="handleSalvarDespesa(event)">
               <input type="hidden" id="despesa-id">
               <input type="hidden" id="despesa-mes">
               <input type="hidden" id="despesa-ano">
               
              <!-- Descrição e Anexos -->
                <div class="form-group-compact">
                    <div class="descricao-anexos-row">
                        <input type="text" id="despesa-descricao" placeholder="Descrição da despesa" required>
                        <button type="button" id="btn-anexar-despesa" class="btn btn-anexar">
                            <i class="fas fa-paperclip"></i>Anexos</button>
                    </div>
                    <div id="lista-anexos-despesa" class="lista-anexos-inline"></div>
                </div>
               
               <!-- Categoria -->
               <div class="form-row-compact">
                   <div class="form-col">
                       <label>Categoria *</label>
                       <div class="categoria-select-wrapper">
                           <select id="despesa-categoria" class="form-control" required onchange="validarCategoria()">
                               <option value="">Selecione...</option>
                               <!-- Categorias serão inseridas dinamicamente aqui pela função atualizarDropdowns() -->
                           </select>
                           <button type="button" id="btn-toggle-nova-categoria" class="btn-add-categoria" title="Adicionar nova categoria">
                               <i class="fas fa-plus"></i>
                           </button>
                       </div>
                       <!-- Input para nova categoria (abaixo do select) -->
                       <div id="nova-categoria-inline" class="nova-categoria-inline hidden">
                           <input type="text" id="input-nova-categoria-despesa" placeholder="Nome da categoria" maxlength="50">
                           <button type="button" id="btn-salvar-categoria-inline" class="btn btn-primary btn-sm">
                               <i class="fas fa-check"></i>
                           </button>
                           <button type="button" id="btn-cancelar-categoria-inline" class="btn btn-secondary btn-sm">
                               <i class="fas fa-times"></i>
                           </button>
                       </div>
                   </div>

                   <div class="form-col">
                        <label>Pagamento *</label>
                        <div class="payment-methods">
                            <div class="payment-option">
                                <input type="radio" id="pagamento-pix" name="forma-pagamento" value="pix" onchange="validarFormaPagamento()">
                                <label for="pagamento-pix">PIX</label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="pagamento-debito" name="forma-pagamento" value="debito" onchange="validarFormaPagamento()">
                                <label for="pagamento-debito">DÉBITO</label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="pagamento-dinheiro" name="forma-pagamento" value="dinheiro" onchange="validarFormaPagamento()">
                                <label for="pagamento-dinheiro">DINHEIRO</label>
                            </div>
                            <div class="payment-option-group" id="credito-options">
                                <!-- Cartões serão inseridos dinamicamente aqui pela função atualizarOpcoesCartoes() -->
                            </div>
                        </div>
                    </div>
               </div>

               <!-- Valores e Parcelas -->
               <div class="form-row-compact form-row-valores">
                   <div class="form-col">
                       <label>Valor original *</label>
                       <input type="number" id="despesa-valor" min="0.01" step="0.01" placeholder="0,00" required onchange="calcularInfoParcelamento()">
                   </div>
                   <div class="form-col">
                       <label>Valor Final</label>
                       <input type="number" id="despesa-valor-pago" min="0" step="0.01" placeholder="0,00" onchange="calcularInfoParcelamento()">
                   </div>
                   <div class="form-col parcelas-col">
                       <label>Parcelas</label>
                       <input type="number" id="despesa-parcelas" min="1" max="999" value="1" onchange="calcularInfoParcelamento()">
                   </div>
               </div>

               <!-- Datas -->
               <div class="form-row-compact">
                   <div class="form-col">
                       <label>Compra *</label>
                       <input type="date" id="despesa-data-compra" required>
                   </div>
                   <div class="form-col">
                       <label>Vencimento *</label>
                       <input type="date" id="despesa-data-vencimento" required>
                   </div>
               </div>
               
               <!-- Info de Parcelamento -->
               <div id="info-parcelamento" class="info-compact hidden">
                   <div class="info-grid">
                       <span>Juros total: <strong id="info-juros-total">R$ 0,00</strong></span>
                       <span>Por parcela: <strong id="info-juros-parcela">R$ 0,00</strong></span>
                       <span>Valor parcela: <strong id="info-valor-parcela">R$ 0,00</strong></span>
                       <span>Total: <strong id="info-valor-total">R$ 0,00</strong></span>
                   </div>
               </div>
               
               <!-- Checkboxes e Botão -->
               <div class="form-footer-compact">
                    <div class="checkboxes-inline">
                        <label class="checkbox-inline">
                            <input type="checkbox" id="despesa-ja-pago">
                            Já está Paga
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="despesa-recorrente">
                            Recorrente
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="despesa-replicar" onchange="toggleReplicarDespesa()">
                            Replicar até
                        </label>
                        <div id="despesa-replicar-options" class="replicar-options hidden">
                            <select id="despesa-replicar-mes" class="form-control form-control-sm">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Março</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                            <select id="despesa-replicar-ano" class="form-control form-control-sm">
                                <!-- Anos serão preenchidos dinamicamente -->
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-salvar-compact">
                        Salvar Despesa
                    </button>
                </div>
           </form>
       </div>
   </div>
</div>



<template id="template-estrutura-despesas-grid">
    <div id="despesas-grid-container" class="tabela-despesas-container">
        <table class="tabela-despesas" id="tabela-despesas">
            <thead>
                <tr>
                    <th class="col-checkbox"><input type="checkbox" id="select-all-despesas" onchange="toggleTodasDespesas(this)"></th>
                    <th class="col-numero">ID</th>
                    <th class="col-descricao">Descrição</th>
                    <th class="col-categoria">Categoria</th>
                    <th class="col-forma-pagamento">Método</th>
                    <th class="col-valor">Valor</th>
                    <th class="col-parcela">Parcela</th>
                    <th class="col-valor-pago">Valor Pago</th>
                    <th class="col-status">Status</th>
                    <th class="col-compra">Compra</th>
                    <th class="col-vencimento">Vencimento</th>
                    <th class="col-data-pagamento">Pagamento</th>
                    <th class="col-acoes">Ações</th>
                    <th class="col-anexos">Anexos</th>
                </tr>
            </thead>
            <tbody id="lista-despesas">
                <!-- Linhas serão inseridas aqui -->
            </tbody>
        </table>
    </div>
</template>

<template id="template-linha-despesa-grid">
    <tr class="despesa-row">
        <td class="col-checkbox"></td>
        <td class="col-numero"></td>
        <td class="col-descricao"></td>
        <td class="col-categoria"></td>
        <td class="col-forma-pagamento"></td>
        <td class="col-valor"></td>
        <td class="col-parcela"></td>
        <td class="col-valor-pago"></td>
        <td class="col-status"></td>
        <td class="col-compra"></td>
        <td class="col-vencimento"></td>
        <td class="col-data-pagamento"></td>
        <td class="col-acoes"></td>
        <td class="col-anexos">
            <button class="btn btn-anexos" data-index="" title="Ver anexos">
                <i class="fas fa-paperclip"></i>
                <span class="contador-anexos">0</span>
            </button>
        </td>
    </tr>
</template>

<template id="template-botoes-acao-despesa">
    <div class="acoes-grupo">
        <button class="btn btn-sm btn-editar" title="Editar">
            <i class="fas fa-edit"></i>
        </button>
        <button class="btn btn-sm btn-excluir" title="Excluir">
            <i class="fas fa-trash"></i>
        </button>
        <button class="btn btn-sm btn-pagar" title="Pagar">
            <i class="fas fa-check"></i>
        </button>
        <button class="btn btn-sm btn-mover" title="Mover para próximo mês">
            <i class="fas fa-arrow-right"></i>
        </button>
    </div>
</template>

<template id="template-valor-com-juros">
    <div class="valor-com-juros">
        <span class="valor-original"></span>
        <span class="valor-juros"></span>
    </div>
</template>

<template id="template-badge-forma-pagamento-despesa">
    <span class="badge-pagamento debito">DÉBITO</span>
</template>

<template id="template-badge-status-despesa">
    <span class="badge-status badge-em-dia">EM DIA</span>
</template>

<template id="template-celula-checkbox-despesa">
    <input type="checkbox" class="despesa-checkbox">
</template>

<!-- Templates para anexos -->
<template id="template-botao-anexos-com-anexos">
    <button class="btn btn-anexos" data-index="" title="">
        <i class="fas fa-paperclip"></i>
        <span class="contador-anexos"></span>
    </button>
</template>

<template id="template-botao-anexos-sem-anexos">
    <button class="btn btn-anexos btn-anexos-vazio" data-index="" title="Nenhum anexo">
        <i class="fas fa-paperclip"></i>
        <span class="contador-anexos">0</span>
    </button>
</template>


<!-- ======================================================== -->
<!-- MODAL: CONFIRMAÇÃO DE EXCLUSÃO DE DESPESAS -->
<!-- ======================================================== -->
<div id="modal-confirmacao-exclusao-despesa" class="modal">
   <div class="modal-content modal-sm">
       <div class="modal-header">
           <h2 id="exclusao-titulo">Excluir item parcelado</h2>
           <button type="button" class="close" data-action="fechar-modal-exclusao" title="Fechar">&times;</button>
       </div>
       <div class="modal-body">
           <p id="exclusao-mensagem">Este item está parcelado. Como deseja prosseguir?</p>
       </div>
       <div class="modal-footer modal-footer-exclusao-despesa">
           <button id="btn-excluir-todos-meses" class="btn btn-danger opcao-exclusao-basica">
               <i class="fas fa-trash"></i> Excluir Despesa
           </button>
           <button id="btn-excluir-parcela-atual" class="btn btn-secondary opcao-exclusao-parcelada">
               <i class="fas fa-times"></i> Excluir apenas esta parcela
           </button>
           <button id="btn-excluir-parcelas-futuras" class="btn btn-secondary opcao-exclusao-parcelada">
               <i class="fas fa-arrow-right"></i> Excluir esta e parcelas futuras
           </button>
           <button id="btn-excluir-todas-parcelas" class="btn btn-danger opcao-exclusao-parcelada">
               <i class="fas fa-trash"></i> Excluir todas as parcelas
           </button>
           <button id="btn-excluir-recorrente-atual" class="btn btn-secondary opcao-exclusao-recorrente">
               <i class="fas fa-times"></i> Excluir apenas esta
           </button>
           <button id="btn-excluir-recorrente-futuras" class="btn btn-secondary opcao-exclusao-recorrente">
               <i class="fas fa-arrow-right"></i> Excluir esta e futuras
           </button>
           <button id="btn-excluir-recorrente-todas" class="btn btn-danger opcao-exclusao-recorrente">
               <i class="fas fa-trash"></i> Excluir todas
           </button>
       </div>
   </div>
</div>


<!-- ======================================================== -->
<!-- MODAL: PAGAMENTO INDIVIDUAL -->
<!-- ======================================================== -->
<div id="modal-pagamento-individual" class="modal">
  <div class="modal-content modal-md">
      <div class="modal-header">
          <h2>Pagar Despesa</h2>
          <button type="button" class="close" title="Fechar">&times;</button>
      </div>
      <div class="modal-body">
          <div id="info-despesa-pagamento" class="info-despesa-container-compact">
              <div class="info-row">
                  <span class="info-label">Descrição:</span>
                  <span class="info-valor" id="pagamento-descricao">-</span>
              </div>
              <div class="info-row">
                  <span class="info-label">Categoria:</span>
                  <span class="info-valor" id="pagamento-categoria">-</span>
              </div>
              <div class="info-row" id="pagamento-forma-container">
                  <span class="info-label">Forma:</span>
                  <span class="info-valor" id="pagamento-forma">-</span>
              </div>
              <div class="info-row">
                  <span class="info-label">Valor Original:</span>
                  <span class="info-valor" id="pagamento-valor-original">R$ 0,00</span>
              </div>
          </div>

          <form id="form-pagamento-individual">
              <div class="form-row-inline">
                  <div class="form-group" style="flex: 1;">
                      <label for="valor-pago-individual">Valor Pago:</label>
                      <input type="number" id="valor-pago-individual" class="form-control" step="0.01" min="0" oninput="calcularDiferencaPagamento()">
                  </div>
                  <div class="form-group" style="width: 180px; margin-left: 10px;">
                      <label>&nbsp;</label>
                      <button type="button" id="btn-anexar-comprovante" class="btn btn-anexar">
                          <i class="fas fa-paperclip"></i>Comprovante</button>
                  </div>
              </div>

              <div id="diferenca-pagamento-info" class="diferenca-info hidden">
                  <span id="diferenca-texto"></span>
              </div>

              <div id="lista-comprovantes" class="lista-anexos-container">
                  <!-- Comprovantes serão inseridos aqui -->
              </div>

              <div class="form-group">
                <label for="data-pagamento-individual">Data do Pagamento:</label>
                <input type="date" id="data-pagamento-individual" class="form-control">
              </div>

              <div class="form-group">
                  <div class="checkbox-row">
                      <input type="checkbox" id="despesa-quitado-individual">
                      <label for="despesa-quitado-individual">Despesa Quitada</label>
                  </div>
                  <div id="info-parcelas-futuras" class="info-texto hidden">
                      Quando marcado, todas as parcelas futuras serão marcadas como pagas e seus valores zerados.
                  </div>
              </div>
          </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-secondary close">
              Cancelar
          </button>
          <button type="submit" form="form-pagamento-individual" class="btn btn-primary">
              <i class="fas fa-check"></i> Confirmar Pagamento
          </button>
      </div>
  </div>
</div>

<!-- ======================================================== -->
<!-- MODAL: PAGAMENTO EM LOTE -->
<!-- ======================================================== -->
<div id="modal-pagamento-lote-despesas" class="modal">
   <div class="modal-content modal-md">
       <div class="modal-header">
           <h2>Pagar Despesas em Lote</h2>
           <button type="button" class="close" title="Fechar">&times;</button>
       </div>
       <div class="modal-body">
           <div class="info-container">
               <p id="lote-contagem-despesas">Você está prestes a pagar despesas em lote.</p>
               <p class="info-texto">O pagamento em lote afeta apenas as despesas do mês atual.</p>
           </div>
           <div class="form-group">
                <label for="data-pagamento-lote">Data do Pagamento (para todas):</label>
                <input type="date" id="data-pagamento-lote" class="form-control">
            </div>
       </div>
       <div class="modal-footer">
           <button type="button" class="btn btn-secondary close">
               Cancelar
           </button>
           <button id="btn-pagar-valor-original" class="btn">
               <i class="fas fa-check"></i> Pagar com valores originais
           </button>
           <button id="btn-pagar-com-valor-personalizado" class="btn">
               <i class="fas fa-edit"></i> Personalizar valores
           </button>
       </div>
   </div>
</div>

<!-- ======================================================== -->
<!-- MODAL: VALORES PERSONALIZADOS -->
<!-- ======================================================== -->
<div id="modal-valores-personalizados-despesas" class="modal">
   <div class="modal-content modal-lg">
       <div class="modal-header">
           <h2>Personalizar Valores de Pagamento</h2>
           <button type="button" class="close" title="Fechar">&times;</button>
       </div>
       
       <div class="modal-body">
           <p>Defina os valores a serem pagos para cada despesa:</p>
           <div class="tabela-container">
               <table class="tabela-valores-personalizados">
                   <thead>
                       <tr>
                           <th>Descrição</th>
                           <th>Categoria</th>
                           <th>Forma Pagamento</th>
                           <th>Valor Original</th>
                           <th>Valor a Pagar</th>
                       </tr>
                   </thead>
                   <tbody id="valores-personalizados-body"></tbody>
               </table>
           </div>
       </div>
       <div class="modal-footer">
           <button type="button" class="btn btn-secondary close">
               Cancelar
           </button>
           <button id="btn-confirmar-valores" class="btn btn-primary">
               <i class="fas fa-check"></i> Confirmar Pagamento
           </button>
       </div>
   </div>
</div>

<!-- ======================================================== -->
<!-- TEMPLATES -->
<!-- ======================================================== -->
<template id="template-linha-valor-personalizado">
   <tr>
       <td class="despesa-descricao">-</td>
       <td class="despesa-categoria">-</td>
       <td class="despesa-forma-pagamento">
           <span class="badge-pagamento">-</span>
       </td>
       <td class="despesa-valor-original">R$ 0,00</td>
       <td>
           <input type="number" class="input-valor-pago" min="0" step="0.01" data-index="">
       </td>
   </tr>
</template>

<!-- ======================================================== -->
<!-- MODAL: SELETOR DE MÊS PARA TRANSAÇÕES RÁPIDAS -->
<!-- ======================================================== -->
<div id="modal-selecionar-mes" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2 id="selecionar-mes-titulo">Selecionar Mês</h2>
            <button type="button" class="close" data-modal="modal-selecionar-mes" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <p>Para qual mês você deseja adicionar a transação?</p>
            <div id="seletor-mes-rapido-grid" class="meses-grid-rapido">
                <button class="mes-btn" data-mes="0">Jan</button>                
                <button class="mes-btn" data-mes="1">Fev</button>
                <button class="mes-btn" data-mes="2">Mar</button>
                <button class="mes-btn" data-mes="3">Abr</button>
                <button class="mes-btn" data-mes="4">Mai</button>
                <button class="mes-btn" data-mes="5">Jun</button>
                <button class="mes-btn" data-mes="6">Jul</button>
                <button class="mes-btn" data-mes="7">Ago</button>
                <button class="mes-btn" data-mes="8">Set</button>
                <button class="mes-btn" data-mes="9">Out</button>
                <button class="mes-btn" data-mes="10">Nov</button>
                <button class="mes-btn" data-mes="11">Dez</button>
            </div>
            <input type="hidden" id="tipo-transacao-rapida">
        </div>
    </div>
</div>

<!-- ================================================================ -->
<!-- TEMPLATES DE MENSAGENS E STATUS (OCULTOS) -->
<!-- ================================================================ -->
<div id="ui-templates" style="display: none;">
    
    <!-- Mensagens de Status do Mês -->
    <div id="template-status-mes-fechado">
        <i class="fas fa-lock"></i> <strong>Mês fechado</strong> - não é possível editar transações
    </div>
    
    <div id="template-status-mes-ativo">
        <i class="fas fa-edit"></i> <strong>Mês ativo</strong> - você pode fechar quando quiser
    </div>
    
    <div id="template-status-mes-vazio">
        <i class="fas fa-plus-circle"></i> Adicione receitas ou despesas para poder fechar o mês
    </div>
    
    <!-- Botões de Controle do Mês -->
    <div id="template-btn-reabrir">
        <button id="btn-reabrir-mes" class="btn btn-warning">
            <i class="fas fa-unlock"></i> Reabrir Mês
        </button>
    </div>
    
    <div id="template-btn-fechar">
        <button id="btn-fechar-mes" class="btn btn-primary">
            <i class="fas fa-lock"></i> Fechar Mês (<span class="saldo-valor"></span>)
        </button>
    </div>
    
    <!-- Títulos com Status -->
    <div id="template-titulo-mes-fechado">
        <i class="fas fa-lock"></i> <span class="mes-nome"></span> de <span class="ano"></span> (Fechado)
    </div>
    
    <div id="template-titulo-mes-ativo">
        <i class="fas fa-chart-bar"></i> <span class="mes-nome"></span> de <span class="ano"></span>
    </div>

</div>

<!-- ======================================================== -->
<!-- MODAIS DE ANEXOS PARA DESPESAS -->
<!-- ======================================================== -->

<!-- Modal: Visualizar anexos da despesa -->
<div id="modal-anexos-despesa" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2>Anexos da Despesa</h2>
            <button type="button" class="close" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div id="lista-anexos-despesa-visualizar" class="lista-anexos-visualizar">
                <!-- Anexos para download serão inseridos aqui -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary close">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>
</div>

<!-- Templates para anexos -->
<template id="template-anexo-item-despesa">
    <div class="anexo-item">
        <div class="anexo-info">
            <i class="anexo-icone"></i>
            <span class="anexo-nome"></span>
        </div>
        <button class="btn btn-remover-anexo" data-anexo-id="">
            <i class="fas fa-times"></i>
        </button>
    </div>
</template>

<template id="template-anexo-download-despesa">
    <div class="anexo-download-item">
        <div class="anexo-info">
            <i class="anexo-icone"></i>
            <span class="anexo-nome"></span>
        </div>
        <button class="btn btn-download-anexo" data-anexo-id="">
            <i class="fas fa-download"></i>
        </button>
    </div>
</template>

<!-- ======================================================== -->
<!-- MODAL: CENTRO DE NOTIFICAÇÕES SIMPLES -->
<!-- ======================================================== -->
<!-- MODAL DE NOTIFICAÇÕES - DESIGN FORMAL E CLEAN -->
<!-- ======================================================== -->
<div id="modal-notificacoes" class="modal hidden">
    <div class="modal-content modal-notificacoes-content">
        <div class="notificacoes-header">
            <h2 class="notificacoes-titulo">
                <i class="fas fa-bell"></i>
                Central de Notificações
            </h2>
            <div class="notificacoes-actions">
                <button id="btn-mark-all-read" class="btn-notif-action" title="Marcar todas como lidas">
                    <i class="fas fa-check"></i>
                </button>
                <button id="btn-clear-notifications" class="btn-notif-action btn-notif-danger" title="Limpar todas">
                    <i class="fas fa-trash"></i>
                </button>
                <button type="button" class="close btn-notif-close" title="Fechar">&times;</button>
            </div>
        </div>
        <div class="notificacoes-body">
            <div id="notifications-list" class="notificacoes-lista">
                <div class="notification-empty">
                    <i class="fas fa-bell-slash empty-icon-notif"></i>
                    <p class="empty-text-notif">Nenhuma notificação no momento</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Template: Item de Notificação -->
<template id="template-notification-item">
    <div class="notification-item" data-id="" data-tipo="">
        <div class="notification-icon-container">
            <i class="fas notification-icon"></i>
        </div>
        <div class="notification-content">
            <div class="notification-header-inline">
                <h4 class="notification-title"></h4>
                <span class="notification-time"></span>
            </div>
            <p class="notification-message"></p>
        </div>
        <div class="notification-actions">
            <button class="btn-mark-read" title="Marcar como lida">
                <i class="fas fa-check"></i>
            </button>
            <button class="btn-delete-notification" title="Excluir">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
</template>
<template id="template-badge-pagamento">
    <span class="badge-pagamento"></span>
</template>

<!-- Template para valor com juros -->
<template id="template-valor-com-juros">
    <div class="valor-com-juros">
        <span class="valor-original"></span>
        <span class="valor-juros"></span>
    </div>
</template>

<!-- Template para badge de forma de pagamento -->
<template id="template-badge-forma-pagamento">
    <span class="badge-pagamento"></span>
</template>

<!-- Template para badge de status -->
<template id="template-badge-status">
    <span class="badge-status"></span>
</template>

<template id="template-mes-card">
    <div class="mes-header">
        <span class="mes-nome"></span>
    </div>
    <div class="mes-body">
        <div class="mes-saldos-container">
            <div class="mes-saldo-anterior hidden">
                <span class="mes-label">Saldo Anterior</span>
                <span class="valor-anterior"></span>
            </div>
            <div class="mes-saldo">
                <span class="mes-label">Saldo Atual</span>
                <span class="mes-saldo-valor"></span>
            </div>
        </div>
        <div class="mes-resumo">
            <div class="mes-valor">
                <span class="mes-label">Receitas</span>
                <span class="mes-receita"></span>
            </div>
            <div class="mes-valor">
                <span class="mes-label">Despesas</span>
                <span class="mes-despesa"></span>
            </div>
        </div>
    </div>
    <div class="mes-footer">
        <button class="btn-toggle-mes btn-reabrir hidden">
            <i class="fas fa-unlock"></i> Reabrir Mês
        </button>
        <button class="btn-toggle-mes btn-fechar hidden">
            <i class="fas fa-lock"></i> Fechar Mês
        </button>
    </div>
</template>



<!-- ================================================================ -->
<!-- CONTROLES DE FECHAMENTO/REABERTURA DE MÊS -->
<!-- ================================================================ -->

<div id="controles-mes" class="controles-mes">
    <div class="status-mes">
        <span id="status-mes-atual" class="status-badge"></span>
    </div>
    <div class="botoes-controle">
        <button id="btn-fechar-mes" class="btn btn-fechar-mes hidden">
            <i class="fas fa-lock"></i> Fechar Mês
        </button>
        <button id="btn-reabrir-mes" class="btn btn-reabrir-mes hidden">
            <i class="fas fa-unlock"></i> Reabrir Mês
        </button>
    </div>
</div>

<!-- ================================================================ -->
<!-- MODAL CONFIRMAÇÃO FECHAMENTO DE MÊS -->
<!-- ================================================================ -->

<div id="modal-confirmar-fechamento" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2><i class="fas fa-lock"></i> Fechar Mês</h2>
            <button type="button" class="close" data-modal="modal-confirmar-fechamento" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div class="confirmacao-fechamento">
                <p id="mensagem-fechamento" class="texto-confirmacao"></p>
                
                <div class="resumo-fechamento">
                    <h4>Resumo do Mês</h4>
                    <div class="resumo-grid">
                        <div class="item-resumo receitas">
                            <div class="icone">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="detalhes">
                                <span class="label">Receitas</span>
                                <span id="resumo-receitas-fechamento" class="valor positivo"></span>
                            </div>
                        </div>
                        
                        <div class="item-resumo despesas">
                            <div class="icone">
                                <i class="fas fa-minus-circle"></i>
                            </div>
                            <div class="detalhes">
                                <span class="label">Despesas</span>
                                <span id="resumo-despesas-fechamento" class="valor negativo"></span>
                            </div>
                        </div>
                        
                        <div class="item-resumo saldo total">
                            <div class="icone">
                                <i class="fas fa-equals"></i>
                            </div>
                            <div class="detalhes">
                                <span class="label">Saldo Final</span>
                                <span id="resumo-saldo-fechamento" class="valor"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="transferencia-info">
                    <div class="info-box">
                        <i class="fas fa-arrow-right"></i>
                        <p id="info-transferencia"></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-cancelar-fechamento" class="btn btn-secondary">
                Cancelar
            </button>
            <button id="btn-confirmar-fechamento" class="btn btn-primary">
                <i class="fas fa-lock"></i> Confirmar Fechamento
            </button>
        </div>
    </div>
</div>

<!-- ================================================================ -->
<!-- MODAL CONFIRMAÇÃO REABERTURA DE MÊS -->
<!-- ================================================================ -->

<div id="modal-confirmar-reabertura" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2><i class="fas fa-unlock"></i> Reabrir Mês</h2>
            <button type="button" class="close" data-modal="modal-confirmar-reabertura" title="Fechar">&times;</button>
        </div>
        <div class="modal-body">
            <div class="confirmacao-reabertura">
                <p id="mensagem-reabertura" class="texto-confirmacao"></p>
                
                <div class="aviso-reabertura">
                    <div class="alerta">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="alerta-conteudo">
                            <h4>Atenção</h4>
                            <ul>
                                <li>A receita de saldo anterior será removida do próximo mês</li>
                                <li>O saldo do próximo mês será recalculado automaticamente</li>
                                <li>Esta ação afetará todos os cálculos subsequentes</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="info-mes-atual">
                    <h4>Dados do Mês Atual</h4>
                    <div class="dados-mes">
                        <div class="dado-item">
                            <span class="label">Receitas:</span>
                            <span id="reabertura-receitas" class="valor"></span>
                        </div>
                        <div class="dado-item">
                            <span class="label">Despesas:</span>
                            <span id="reabertura-despesas" class="valor"></span>
                        </div>
                        <div class="dado-item">
                            <span class="label">Saldo:</span>
                            <span id="reabertura-saldo" class="valor"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-cancelar-reabertura" class="btn btn-secondary">
                Cancelar
            </button>
            <button id="btn-confirmar-reabertura" class="btn btn-danger">
                <i class="fas fa-unlock"></i> Confirmar Reabertura
            </button>
        </div>
    </div>
</div>

<!-- ================================================================ -->
<!-- TEMPLATES PARA NOTIFICAÇÕES DE FECHAMENTO -->
<!-- ================================================================ -->

<template id="template-status-mes-aberto">
    <span class="status-badge aberto">
        <i class="fas fa-unlock"></i> Mês Aberto
    </span>
</template>

<template id="template-status-mes-fechado">
    <span class="status-badge fechado">
        <i class="fas fa-lock"></i> Mês Fechado
    </span>
</template>

<template id="template-notificacao-fechamento-sucesso">
    <div class="notificacao sucesso fechamento">
        <i class="fas fa-check-circle"></i>
        <div class="conteudo">
            <h4>Mês fechado com sucesso!</h4>
            <p class="mensagem"></p>
        </div>
    </div>
</template>

<template id="template-notificacao-reabertura-sucesso">
    <div class="notificacao sucesso reabertura">
        <i class="fas fa-unlock"></i>
        <div class="conteudo">
            <h4>Mês reaberto com sucesso!</h4>
            <p class="mensagem"></p>
        </div>
    </div>
</template>

<template id="template-notificacao-erro-fechamento">
    <div class="notificacao erro fechamento">
        <i class="fas fa-exclamation-circle"></i>
        <div class="conteudo">
            <h4>Erro ao fechar mês</h4>
            <p class="mensagem"></p>
        </div>
    </div>
</template>

<!-- ================================================================ -->
<!-- INDICADORES DE PROCESSAMENTO -->
<!-- ================================================================ -->

<div id="loading-fechamento" class="loading-overlay loading-fechamento hidden">
    <div class="loading-content">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
        <div class="loading-texto">
            <h4 id="loading-titulo">Processando...</h4>
            <p id="loading-descricao">Aguarde enquanto processamos a operação</p>
        </div>
    </div>
</div>

<!-- JAVASCRIPT EXTERNOS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Input files para anexos -->
<input type="file" id="input-file-anexos-receita" multiple accept=".pdf,.jpg,.jpeg,.png,.gif" style="display: none;">
<input type="file" id="input-file-anexos-despesa" multiple accept=".pdf,.jpg,.jpeg,.png,.gif" style="display: none;">
<input type="file" id="input-file-comprovante" multiple accept=".pdf,.jpg,.jpeg,.png,.gif" style="display: none;">

<!-- Bibliotecas externas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://sdk.mercadopago.com/js/v2"></script>

<!-- Sistema base -->
<script src="js/usuarioDados.js"></script>
<script src="js/main.js"></script>
<script src="js/logs.js"></script>
<script src="js/configuracao.js"></script>
<script src="js/receita.js"></script>
<script src="js/despesas.js"></script>
<script src="js/anexos.js"></script>

<!-- Loader Global para Importação -->
<div id="global-loader">
    <div class="loader-content">
        <div class="loader-spinner"></div>
        <p class="loader-text">Importando dados...</p>
        <p class="loader-subtext">Por favor, aguarde</p>
        <p class="loader-progress" id="loader-progress"></p>
    </div>
</div>

<!-- Módulos secundários -->
<script src="js/dashboard.js"></script>
<script src="js/notificacao.js"></script>
<script src="js/rel.js"></script>

</body>
</html>